"use strict";function _classCallCheck(e,n){if(!_instanceof(e,n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,n,r){return n&&_defineProperties(e.prototype,n),r&&_defineProperties(e,r),e}function asyncGeneratorStep(e,n,r,t,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void r(e)}s.done?n(i):Promise.resolve(i).then(t,o)}function _asyncToGenerator(s){return function(){var e=this,c=arguments;return new Promise(function(n,r){var t=s.apply(e,c);function o(e){asyncGeneratorStep(t,n,r,o,a,"next",e)}function a(e){asyncGeneratorStep(t,n,r,o,a,"throw",e)}o(void 0)})}}function _instanceof(e,n){return null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](e):e instanceof n}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var n=0,r=new Array(e.length);n<e.length;n++)r[n]=e[n];return r}}!function(){var o="https://api.npms.io/v2/search",i="https://api.github.com/repos",u="https://cdn.jsdelivr.net/gh/",c="https://unpkg.com";function E(){var e=arguments;return new Promise(function(n,r){fetch.apply(void 0,_toConsumableArray(e)).then(function(e){return e.ok?e.json().then(n,r):r(e)},r)})}function T(e,n){if("object"===_typeof(n))for(var r in n){var t=n[r];e+="+".concat(r,":").concat(_instanceof(t,Array)?t.join(","):t)}return E("".concat(o,"?q=").concat(e))}function R(o,a){return new Promise(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a,e.next="github"===e.t0?3:"unpkg"===e.t0?5:7;break;case 3:try{r(s(o))}catch(e){t(e)}return e.abrupt("break",7);case 5:return r((n=o,"".concat(c,"/").concat(n.name,"@").concat(n.version))),e.abrupt("break",7);case 7:case"end":return e.stop()}var n},e)}));return function(e,n){return r.apply(this,arguments)}}())}function s(e){return n.apply(this,arguments)}function n(){return(n=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var r,t,o,a,c,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null===n.links.repository.match(/github\.com/))throw r="".concat(n.name," does not use github as it's repository. Found ").concat(n.links.respository),console.error(r),new Error({msg:r,details:n});e.next=4;break;case 4:return console.log("Loading via GitHub using ".concat(n.links.respository)),t=n.links.repository.replace(/(^.*github\.com\/|\/$)/g,""),e.prev=6,e.next=9,E("".concat(i,"/").concat(t,"/tags"));case 9:if(0===(o=e.sent).length)throw o;e.next=12;break;case 12:e.next=20;break;case 14:throw e.prev=14,e.t0=e.catch(6),a="No tags found for ".concat(n.name,"'s listed repo. Unable to pull stable release. Aborting"),console.error(a),new Error({msg:a,details:e.t0});case 20:return void 0===(c=o.find(function(e){return e.name===n.version||e.name==="v".concat(n.version)}))?(s=o[0].name,console.warn("Unable to find a suitable repo tag for version ".concat(n.version,". Using the latest tag (").concat(s,") instead."))):s=c.name,e.abrupt("return","".concat(u,"/").concat(t,"/").concat(s));case 23:case"end":return e.stop()}},e,null,[[6,14]])}))).apply(this,arguments)}var e=function(){function j(){_classCallCheck(this,j)}return _createClass(j,null,[{key:"get",value:function(_,e){var n=Object.assign({},{npmFilters:{not:["deprecated","insecure","unstable"]},cdnProviders:["unpkg","github"]},e),P=n.npmFilters,S=n.forcePackage,C=n.cdnProviders,A=n.filePath;return new Promise(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(n,r){var t,o,a,c,s,i,u,l,p,f,g,d,m,h,v,y,b,k,w,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T(_,P);case 3:t=e.sent,e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(0),o="Error searching NPM registry.",console.error(o),r({msg:o,details:e.t0}),e.abrupt("return");case 12:if(0===t.total)return a="No results found for ".concat(_,"."),console.error(a),r({msg:a,details:t}),e.abrupt("return");e.next=17;break;case 17:if(parseInt(t.results[0].searchScore)<100&&!S)return c="Couldn't find an exact match for ".concat(_,".\n\n")+"Use wnpm.search to determine the correct package name or use the 'forcePackage' option with wnpm.get",console.error(c),r({msg:c,details:t}),e.abrupt("return");e.next=22;break;case 22:s=S-1||0,i=t.results[s].package,console.log("Found ".concat(_," as ").concat(i.name," at ").concat(i.version,"; using ").concat(i.links.repository)),f=!(p=!(l=!1)),g=void 0,e.prev=29,d=C[Symbol.iterator]();case 31:if(p=(m=d.next()).done){e.next=47;break}return h=m.value,e.prev=33,e.next=36,R(i,h);case 36:return u=e.sent,l=!0,e.abrupt("break",47);case 41:e.prev=41,e.t1=e.catch(33),console.warn("Could not generate a CDN URL for ".concat(h));case 44:p=!0,e.next=31;break;case 47:e.next=53;break;case 49:e.prev=49,e.t2=e.catch(29),f=!0,g=e.t2;case 53:e.prev=53,e.prev=54,p||null==d.return||d.return();case 56:if(e.prev=56,f)throw g;e.next=59;break;case 59:return e.finish(56);case 60:return e.finish(53);case 61:if(l){e.next=66;break}return v="Couldn't generate a CDN URL for any provider",console.error(v),r({msg:v,details:i}),e.abrupt("return");case 66:return e.prev=66,e.next=69,E("".concat(u,"/package.json"));case 69:k=e.sent,console.log("package.json retrieved"),_instanceof(k.dependencies,Array)&&0<k.dependencies.length&&console.log("This package appears to have dependencies. You may have issues running this package."),b="unpkg"in k&&"string"==typeof k.unpkg?"unpkg":"browser"in k&&"string"==typeof k.browser?"browser":"main",y=A||k[b]||"index.js",console.log("Loading package ".concat(b," file: ").concat(y)),e.next=82;break;case 77:e.prev=77,e.t3=e.catch(66),w="Error retrieving package.json for ".concat(i.name,". Status: ").concat(e.t3.status),console.error(w),r({msg:w,details:e.t3});case 82:return e.prev=82,e.next=85,j.load("".concat(u,"/").concat(y));case 85:console.log("".concat(i.name," loaded!")),n(i),e.next=94;break;case 89:e.prev=89,e.t4=e.catch(82),x="An error occurred loading the script.",console.error(x),r({msg:x,details:e.t4});case 94:case"end":return e.stop()}},e,null,[[0,6],[29,49,53,61],[33,41],[54,,56,60],[66,77],[82,89]])}));return function(e,n){return r.apply(this,arguments)}}())}},{key:"getAll",value:function(e,n){return Promise.all(e.map(function(e){return j.get(e,n)}))}},{key:"load",value:function(t){return new Promise(function(e,n){var r=document.createElement("SCRIPT");r.addEventListener("load",e,!1),r.addEventListener("error",n,!1),r.src=t,document.body.appendChild(r)})}},{key:"search",value:function(e,n){var a=0<arguments.length&&void 0!==e?e:"",c=1<arguments.length&&void 0!==n?n:{};return new Promise(function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function e(n,r){var t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,T(a,c);case 3:t=e.sent,e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(0),o="Error searching NPM registry",console.error(o),r({msg:o,details:e.t0}),e.abrupt("return");case 12:console.groupCollapsed("".concat(t.total," found for ").concat(a)),t.results.forEach(function(e,n){console.groupCollapsed("".concat(n+1,". ").concat(e.package.name)),console.log("Result score: ".concat(parseInt(100*e.score.final),"%")),console.log(e.package.description),e.searchScore<100?console.log("%cThis package would not be selected automatically with wnpm.get","color: red"):console.log("%cThis package could be selected automatically with wnpm.get","color: green"),console.groupEnd()}),console.groupEnd(),n(t);case 16:case"end":return e.stop()}},e,null,[[0,6]])}));return function(e,n){return r.apply(this,arguments)}}())}}]),j}();window.wnpm=e}();